### 单机存储引擎

存储引擎时存储系统的发动机，**直接决定了存储系统能够提供的性能和功能**（CURD）。

读取分为**随机读取**和**顺序读取**——**哈希存储引擎时哈希表持久化实现**，**但是不支持顺序扫描**，对应的存储系统为件**键值存储系统（key-value）**；**B树（B-Tree）存储引擎时B树的持久化实现**，不仅支持单挑记录的CURD，还支持**顺序扫描**，对应的存储系统是**关系数据库**【ps：当然**键值系统也可以通过B树存储引擎实现**】。**LSM树【Log-Structured Merge Tree】存储引擎和B树存储引擎一样**，支持CURD——包括**随机读取**以及**顺序扫描**。他通过**批量转存储技术**规避磁盘随机写入的问题,广泛应用于互联网的后台存储系统——**Google Bigtable， Google LevelDB以及Facebook开源的Cassandra系统**

#### 2.2.1 哈希存储引擎

Bitcask是一个基于哈希表结构的键值存储系统，它仅支持追加操作，即所有的的写操作之追加而不修改老数据。在bitcask系统中，每个文件有一定的大小限制，当文件增加到相应的大小时，就会产生一个新的文件，老的文件只读不写。**在任意时刻，只有一个文件是可写的**，用于数据追加，称为活跃数据文件。而其他已经达到大小限制的文件，称为老数据文件。

##### 	1. 数据结构

​	Bitcask数据文件中的数据是一条一条的写入操作，每一条记录的数据项分别为**主键key，value内容，主键长度key_sz,value_sz，时间戳timestamp以及crc校验值。**（数据删除操作也不会删除旧的条目，**而是将value设定为一个特殊的值做标识**）。内存中采用基于哈希表的索引数据结构，**哈希表的作用是通过主键快速定位到value的位置**。哈希表结构中的每一项包含了三个用于定位数据的信息，分别是**文件编号file id，value所在文件中的位置value_pos，value长度value_sz**，通过读取file id对应的文件的value_pos开始的value_sz个字节，这就得到了最终value值。写入时首先将Key-Value记录追加到活跃数据文件的末尾，接着更新内存哈希表，因此，**每个写操作总共需要进行一次顺序的磁盘写入和一次内存操作。**