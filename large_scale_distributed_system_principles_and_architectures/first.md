##1.概述

无论是云计算还是大数据还是互联网公司的各种应用，其后台基础设施的主要目标都是构建低成本、高性能、可拓展、易用的分布式存储系统

###1.1 分布式存储的概念

​	大规模分布式存储系统的**定义**：

​		分布式存储系统是大量的PC服务器通过internet互联，对外作为一个整体提供存储服务

​	**特性**：

​		可拓展        随着集群规模的增长，系统整体性能表现为线性增长

​		底层本        自动容错、自动负载均衡，先行拓展方便，自动运维

​		高性能	集群/单台

​		易用            提供易用的对外接口，完善的监控运维工具，方便的与其他系统集成  e.g. Hadoop云计算系统导入数据

​	**主要挑战**

​		数据、状态信息的持久化

​		自动迁移、自动容错、并发读写的过程中保证数据的一致性

​	**两个领域**

​		分布式系统

​		数据库

​			**数据分布**：如何将分布到多台服务器才能够保证数据分布均匀？数据分布到多台服务器后如何实现跨服务器读写操作？

​			**一致性**：如何将数据的多个副本复制到多台服务器，即使在异常的情况下，也能够保证不同副本之间的数据的一致性？【可以参考hadoop中的检查机制secondnamenode和FSImage和EditLog】

​			**容错**：如何检测到服务器故障？如何自动将出现故障的服务器上的数据和服务迁移到集群中其他服务器？【zookeeper？keep alive？】

​			**负载均衡**：新增服务器和集群正常运行过程中如何实现自动负载均衡？数据迁移的古过程中如何保证不影响已有业务？【mongodb的均衡机制？uuid？】

​			**事务与并发控制**：如何实现分布式事务？如何实现多版本并发控制？

​			**易用性**：如何设计对外接口使得系统容易使用？ 设计监控系统并将系统的内部状态以方便的形式暴露给运维人员

​			**压缩、解压缩**：如何根据数据的特点设计合理的压缩/解压缩**算法**？如何平衡压缩算法节省的存储空间和消耗的CPU计算资源

​	分布式存储系统挑战大，研发周期长，涉及的知识面广。一般来讲，工程师如果能够深入理解分布式存储系统，理解其他互联网后台架构不会再有任何困难

### 1.2 分布式存储分类

​	分布式存储面临的数据需求比较复杂，大致分为三类

​		**结构化数据**：一般存储在关系型数据库中，可以用二维关系表结构来表示。结构化数据的模式（Schema，包括属性、数据类型以及数据之间的联系）和内容是分开的，数据的模式需要预先定义

​		**非结构化数据**：包括所有格式的文档、文本、图片、图像、音频和视频信息

​		**半结构化数据**：介于非结构化数据和结构化数据之间，HTML文档久属于半结构化数据。一般是自描述的，与结构化数据最大的区别在于，半结构化数据的模式和内容混在一起，没有明显的区分，也不需要预先定义数据的模式结					构

​	不同的分布式存储系统适合处理不同类型的数据：

​		**分布式文件系统**

​		**分布式键值（Key-Value）系统**

​		**分布式表格系统**

​		**分布式数据库**

##### 分布式文件系统

​	Blob：Binary Large Object  二进制大对象数据

​	图片，照片、视频等非结构化数据对象，这类数据以对象的形式组织，对象之间没有关联

​	**典型系统**：Facebook Haystack，Taobao File System(TFS)

​	**常常作为分布式表格系统以及分布式数据库**底层存储：

​		**谷歌的Google File System（GFS, 存储大文件）可以作为分布式表格系统Google Bigtable的底层存储**

​		**Amazon的Elastic Block Store（EBS 弹性快存储）系统可以作为分布式数据库Amazon RDS 的底层存储**

​	总结：存储三种类型的数据：Blob对象，定长块，以及大文件

​		在系统实现层面，分布式文件系统内部按照**数据块chunk**来组织数据，每个数据块的大小大致相同，每个数据块可以包含多个Blob对象或者定长块，一个大文件也可以拆为多个数据块，如图

​		分布式文件系统将这些数据块分散到存储集群，处理数据复制、一致性、负债均衡、容错等分布式系统难题，并将用户对Blob对象、定长块以及大文件的操作**映射为对底层数据块的操作**

![](E:\auto\Distribute\large_scale_distributed_system_principles_and_architectures\1001.png)



##### 分布式键值系统

​	分布式键值系统用于存储关系简单的半结构化数据，它只提供基于主键的CURD功能

​	**典型**：**Amazn** **Dynamo**，以及**Taobao Tair**

​		从数据结构角度来看，分布式简直系统与传统的哈希表类似，不同的是，**分布式简直系统支持将数据分布到集群中的多个存储节点**

​		**分布式简直系统是分布式表格系统的一种简化实现**

​		**一般用作缓存**：比如**Taobao Tair**以及**Memcache**

##### 分布式表格系统

​	分布式表格系统用于存储关系较为复杂的半结构化数据，**与分布式键值系统相比，分布式表格系统不仅仅支持简单的CURD操作，而且支持扫描某个主键范围**

​			以表格为单位组织数据，每个表格包括很多行，**通过主键标识一行**，支持根据主键的CURD功能以及范围查找功能

​	分布式表格系统借鉴了很多数据库的技术：

​			**支持某种程度上的事务**：单行事务，某个实体组（Enitity Group，**一个用户的所有数据往往构成一个实体组**）下多行事务

​			**典型系统**：Google Bigtable以及Megastore，Microsoft Azure Table Storage，Amazon DynamoDB等

​			**与分布式数据库相比**，分布式表格系统**主要支持针对单张表格**的操作，不支持一些复杂的操作，比如多表关联和连接，嵌套子查询；

​							   另外，在分布式表格系统中，**同一个表格系统是一种很好的权衡**，这类系统可以做到**超大规模**，而且支持较低的功能，但是实现往往比较复杂且有一定的使用门槛

##### 分布式数据库

​	分布式数据库一般是从单机关系数据库拓展而来，用于存储结构化数据。

​	提供SQL关系查询语言，支持多表关联，嵌套子查询等复杂操作

​	**提供数据库事务以及并发控制**

​	典型系统：**MySQL数据库分片MySQL Sharding集群**，Amazon RDS以及Microsoft SQL Azure

​	功能最为丰富，符合用户使用习惯，**但是可拓展型往往受到限制**——并非绝对

​		Google Spanner系统式一个支持多数据中心的分布式数据库，不仅支持丰富的关系型数据库功能，还能拓展到多个数据中心的成千上万台机器

​		阿里巴巴的**OceanBase**系统也是一个支持自动拓展的分布式关系数据库

​	关系数据库目前式最为成熟的存储技术——产生Oracle， Microsoft SQL Server，IBM DB2, MySQL以及上层的工具及应用生态链

​	在可拓展性面临巨大挑战——传统数据库的事务以及二维关系模型很难高效地拓展到多个存储节点上，关系型数据库对于要求**高并发**地应用在性能上优化空间较大。

​	————产生各种非关系型数据库NoSQL

